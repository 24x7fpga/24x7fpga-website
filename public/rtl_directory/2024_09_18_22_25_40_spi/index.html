<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>SPI | Home</title>
<meta name="keywords" content="rtl">
<meta name="description" content="Source &ndash; RTL Design Directory
SPI: Overview
The Serial Peripheral Interface (SPI) is a widely used communication protocol that enables microcontrollers to interact with external peripherals such as OLED displays, sensors, and SD cards. Known for its simplicity SPI facilitates efficient data exchange between devices in embedded systems.
SPI and UART are both serial communication protocols used to exchange data between peripheral devices, but they differ significantly in how they achieve synchronization. SPI is a synchronous protocol, meaning it relies on a shared clock signal to synchronize data transfer between the transmitter and receiver, ensuring precise timing. In contrast, UART is asynchronous, operating without a clock signal and instead relying on predefined transmission speeds and additional start and stop bits to maintain synchronization. This fundamental difference makes SPI more efficient for high-speed data transfer, while UART is simpler but more prone to timing mismatches and overhead.">
<meta name="author" content="Kiran">
<link rel="canonical" href="https://24x7fpga.com/rtl_directory/2024_09_18_22_25_40_spi/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.28ee19e1ed9d982499c62390d2acb416195f5655651bae2a84b5090fab8908e0.css" integrity="sha256-KO4Z4e2dmCSZxiOQ0qy0FhlfVlVlG64qhLUJD6uJCOA=" rel="preload stylesheet" as="style">
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">

<link rel="icon" href="https://24x7fpga.com/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://24x7fpga.com/assets/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://24x7fpga.com/assets/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://24x7fpga.com/assets/apple-touch-icon.png">
<link rel="mask-icon" href="https://24x7fpga.com/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://24x7fpga.com/rtl_directory/2024_09_18_22_25_40_spi/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript>

<link rel="stylesheet" href="../../zcustom.css">


<meta property="og:title" content="SPI" />
<meta property="og:description" content="Source &ndash; RTL Design Directory
SPI: Overview
The Serial Peripheral Interface (SPI) is a widely used communication protocol that enables microcontrollers to interact with external peripherals such as OLED displays, sensors, and SD cards. Known for its simplicity SPI facilitates efficient data exchange between devices in embedded systems.
SPI and UART are both serial communication protocols used to exchange data between peripheral devices, but they differ significantly in how they achieve synchronization. SPI is a synchronous protocol, meaning it relies on a shared clock signal to synchronize data transfer between the transmitter and receiver, ensuring precise timing. In contrast, UART is asynchronous, operating without a clock signal and instead relying on predefined transmission speeds and additional start and stop bits to maintain synchronization. This fundamental difference makes SPI more efficient for high-speed data transfer, while UART is simpler but more prone to timing mismatches and overhead." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://24x7fpga.com/rtl_directory/2024_09_18_22_25_40_spi/" /><meta property="article:section" content="rtl_directory" />
<meta property="article:published_time" content="2024-09-18T22:25:00-04:00" />
<meta property="article:modified_time" content="2024-09-18T22:25:00-04:00" />



<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="SPI"/>
<meta name="twitter:description" content="Source &ndash; RTL Design Directory
SPI: Overview
The Serial Peripheral Interface (SPI) is a widely used communication protocol that enables microcontrollers to interact with external peripherals such as OLED displays, sensors, and SD cards. Known for its simplicity SPI facilitates efficient data exchange between devices in embedded systems.
SPI and UART are both serial communication protocols used to exchange data between peripheral devices, but they differ significantly in how they achieve synchronization. SPI is a synchronous protocol, meaning it relies on a shared clock signal to synchronize data transfer between the transmitter and receiver, ensuring precise timing. In contrast, UART is asynchronous, operating without a clock signal and instead relying on predefined transmission speeds and additional start and stop bits to maintain synchronization. This fundamental difference makes SPI more efficient for high-speed data transfer, while UART is simpler but more prone to timing mismatches and overhead."/>

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Rtl_directories",
      "item": "https://24x7fpga.com/rtl_directory/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "SPI",
      "item": "https://24x7fpga.com/rtl_directory/2024_09_18_22_25_40_spi/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "SPI",
  "name": "SPI",
  "description": "Source \u0026ndash; RTL Design Directory\nSPI: Overview The Serial Peripheral Interface (SPI) is a widely used communication protocol that enables microcontrollers to interact with external peripherals such as OLED displays, sensors, and SD cards. Known for its simplicity SPI facilitates efficient data exchange between devices in embedded systems.\nSPI and UART are both serial communication protocols used to exchange data between peripheral devices, but they differ significantly in how they achieve synchronization. SPI is a synchronous protocol, meaning it relies on a shared clock signal to synchronize data transfer between the transmitter and receiver, ensuring precise timing. In contrast, UART is asynchronous, operating without a clock signal and instead relying on predefined transmission speeds and additional start and stop bits to maintain synchronization. This fundamental difference makes SPI more efficient for high-speed data transfer, while UART is simpler but more prone to timing mismatches and overhead.\n",
  "keywords": [
    "rtl"
  ],
  "articleBody": "Source – RTL Design Directory\nSPI: Overview The Serial Peripheral Interface (SPI) is a widely used communication protocol that enables microcontrollers to interact with external peripherals such as OLED displays, sensors, and SD cards. Known for its simplicity SPI facilitates efficient data exchange between devices in embedded systems.\nSPI and UART are both serial communication protocols used to exchange data between peripheral devices, but they differ significantly in how they achieve synchronization. SPI is a synchronous protocol, meaning it relies on a shared clock signal to synchronize data transfer between the transmitter and receiver, ensuring precise timing. In contrast, UART is asynchronous, operating without a clock signal and instead relying on predefined transmission speeds and additional start and stop bits to maintain synchronization. This fundamental difference makes SPI more efficient for high-speed data transfer, while UART is simpler but more prone to timing mismatches and overhead.\nFigure 1: SPI Controller, Peripheral Connection\nChip Select (CS): This signal is active low and is used to initiate communication with the peripheral device. Serial Clock (SCK): A clock signal generated by the controller to synchronize data transfer between the controller and the peripheral. Serial Data Out (SDO): The data line used by the controller to send serial data to the peripheral device. Serial Data In (SDI): The data line through which the peripheral sends serial data back to the controller. SPI Controller An SPI Controller is a hardware module that manages communication between a master device (typically a microcontroller or processor) and one or more peripheral devices in an SPI (Serial Peripheral Interface) system. It controls the flow of data by generating the necessary signals for synchronization and data transfer. The SPI controller produces the Serial Clock (SCK), which ensures that both the master and the peripheral are synchronized. It also controls the Chip Select (CS) signal, which activates the communication with a specific peripheral device, and manages the Serial Data Out (SDO) and Serial Data In (SDI) lines to transmit and receive data. The SPI interface can have only one controller, but may control multiple slaves. The controller’s role is essential for efficient and reliable data exchange, as it ensures that all timing and signaling requirements are met for smooth communication.\nSPI Peripheral An SPI Peripheral is a device that communicates with the master controller over the SPI bus. It can be anything from sensors, displays, memory chips, to other microcontrollers. The peripheral is designed to respond to commands from the master by sending or receiving data through the Serial Data In (SDI) and Serial Data Out (SDO) lines. It is activated when the Chip Select (CS) signal from the master is pulled low, indicating the start of communication. The peripheral synchronizes data transfer with the master using the Serial Clock (SCK), which is provided by the SPI controller. The SPI peripheral’s role is to either transmit data to the master or respond to data requests, depending on the operation, while ensuring accurate timing and signal integrity based on the clock and chip select signals.\nData Transfer The SPI protocol operates using a master-slave configuration, where the master (controller) device takes full control of the communication. The master generates the Serial Clock (SCK), ensuring data transfer is perfectly synchronized with the connected peripheral devices.\nCommunication begins when the master pulls the Chip Select (CS) line low for the intended peripheral. This activates the specific peripheral, allowing data exchange to take place.\nIn systems with multiple peripherals, each device is typically assigned its own CS line, enabling the master to communicate with one device at a time by toggling the appropriate CS line.\nSPI supports full-duplex communication, meaning data is transferred in both directions simultaneously. The master sends data to the peripheral via the Serial Data Out (SDO) line, while the peripheral responds with data through the Serial Data In (SDI) line. These data transfers occur in parallel, ensuring high-speed communication.\nThe synchronization of data is managed by the SCK signal generated by the master. Depending on the chosen communication mode, data is shifted in and out of devices on either the rising or falling edge of the clock signal.\nData is transferred in frames, with each frame consisting of a fixed number of bits, commonly 8 bits per byte. For every bit of data, the master sends a clock pulse, ensuring the data is read or written at precisely the right moment.\nClock Phase and Polarity The SPI interface provides four different clock modes for data transfer, providing a choice of clock phase (delay) and clock polarity (rising or falling edge).\nTable 1: Clock Mode Clock Mode Clock Polarity (CPOL) Clock Phase (CPHA) Description Mode 0 0 0 Data is output on the rising edge of the clock (SCK). Input data is latched on the falling edge of the clock. Mode 1 0 1 Data is output one-half clock cycle before the first rising edge of SCK and subsequently on the falling edge. Input data is latched on the rising edge of the clock. Mode 2 1 0 Data is output on the falling edge of the clock (SCK). Input data is latched on the rising edge of the clock. Mode 3 1 1 Data is output one-half clock cycle before the first falling edge of SCK and subsequently on the rising edge. Input data is latched on the falling edge of the clock. Source: SPI User Guide\nFigure 2: Clock Modes\nSPI Transmitter The SPI transmitter is a key component of the SPI protocol, also known as SPI Controller, responsible for sending data from the master device to the peripheral. Its operation is synchronized with the SPI clock (SCK) to ensure accurate and efficient data transfer.\n`timescale 1ns/1ns module spi_tx #(parameter mode = 0, dvsr = 31, width = 8) (/*AUTOARG*/ // Outputs sdo, sclk, cs, tx_dout, tx_rdy, rx_vld, // Inputs sdi, tx_vld, din, rst, clk ); //outputs output sdo; output sclk; output cs; output [width-1: 0] tx_dout; output\ttx_rdy; output\trx_vld; //input input\tsdi; input\ttx_vld; input [width-1: 0] din; input\trst; input\tclk; /*AUTOREG*/ // Beginning of automatic regs (for this module's undeclared outputs) reg\trx_vld; reg\ttx_rdy; // End of automatics /*AUTOWIRE*/ // fsm states typedef enum {idle, drive, sample} state_type; state_type st_reg, st_nxt; logic [$clog2(dvsr): 0] dvsr_reg, dvsr_nxt; logic [width-1: 0]\tcnt_reg, cnt_nxt; logic\tcpol, cpha; logic\ttemp_clk, sclk_reg, sclk_nxt; logic\tcs_reg, cs_nxt; logic [width-1:0]\tsdo_reg, sdo_nxt; logic [width-1:0]\tsdi_reg, sdi_nxt; // spi mode decoder always_comb begin case(mode) 'h0 : begin cpol = 0; cpha = 0; end 'h1 : begin cpol = 0; cpha = 1; end 'h2 : begin cpol = 1; cpha = 0; end 'h3 : begin cpol = 1; cpha = 1; end endcase // case (mode) end // always_comb always_ff@(posedge clk) if(rst)begin st_reg \u003c= idle; cnt_reg \u003c= 0; dvsr_reg \u003c= 0; sclk_reg \u003c= 0; sdo_reg \u003c= 0; sdi_reg \u003c= 0; cs_reg \u003c= 1; end else begin st_reg \u003c= st_nxt; cnt_reg \u003c= cnt_nxt; dvsr_reg \u003c= dvsr_nxt; sclk_reg \u003c= sclk_nxt; sdo_reg \u003c= sdo_nxt; sdi_reg \u003c= sdi_nxt; cs_reg \u003c= cs_nxt; end always_comb begin st_nxt = st_reg; cnt_nxt = cnt_reg; dvsr_nxt = dvsr_reg; sdo_nxt = sdo_reg; cs_nxt = cs_reg; rx_vld = 0; case(st_reg) idle: begin if(tx_vld)begin cs_nxt = 0; dvsr_nxt = dvsr_reg + 1; if(dvsr_reg == dvsr)begin st_nxt = drive; dvsr_nxt = 0; end end end drive: begin sdo_nxt = din \u003c\u003c cnt_reg; dvsr_nxt = dvsr_reg + 1; if(dvsr_reg == dvsr)begin st_nxt = sample; dvsr_nxt = 0; end end sample: begin // read sdi sdi_nxt[width-1-cnt_reg] = sdi; dvsr_nxt = dvsr_reg + 1; if(dvsr_reg == dvsr)begin cnt_nxt = cnt_reg + 1; dvsr_nxt = 0; if(cnt_reg == width-1) begin cnt_nxt = 0; rx_vld = 1; if(~tx_vld) st_nxt = idle; end st_nxt = drive; end end endcase // case (st_reg) end // always_comb // look-ahead decoder assign temp_clk = (st_nxt == drive \u0026\u0026 cpha) || (st_nxt == sample \u0026\u0026 ~cpha); // spi clk assign sclk_nxt = (cpol) ? ~temp_clk : temp_clk; // registered data assign cs = cs_reg; assign sclk = sclk_reg; assign sdo = sdo_reg[width-1]; assign tx_dout = sdi_reg; endmodule // spi_tx // Local Variables: // Verilog-Library-Directories: (\".\") // End: SPI Receiver The SPI receiver is the peripheral device in an SPI communication system responsible for receiving data from the master device. It works in synchronization with the master by relying on the clock signal (SCK) generated by the master for precise timing.\n`timescale 1ns/1ns module spi_rx #(parameter mode = 0, width = 8) (/*AUTOARG*/ // Outputs sdi, rx_dout, // Inputs sdo, sclk, cs, rst, clk ); // outputs output sdi; output [width-1:0] rx_dout; //input input\tsdo; input\tsclk; input\tcs; input\trst; input\tclk; /*AUTOREG*/ // Beginning of automatic regs (for this module's undeclared outputs) reg\tsdi; // End of automatics /*AUTOWIRE*/ // fsm states typedef enum {idle, sample} state_type; state_type st_reg, st_nxt; logic [width-1:0]\tcnt_reg, cnt_nxt; logic [width-1:0]\tdin_reg, din_nxt; generate if(mode == 0 || mode == 3)begin always_ff@(posedge sclk, posedge rst) if(rst)begin st_reg \u003c= idle; cnt_reg \u003c= 0; din_reg \u003c= 0; end else begin st_reg \u003c= st_nxt; cnt_reg \u003c= cnt_nxt; if(~cs)begin din_reg \u003c= {din_reg[width-2:0],sdo}; sdi \u003c= din_reg[width-1]; end end end if(mode == 1 || mode == 2)begin always_ff@(negedge sclk, posedge rst) if(rst)begin st_reg \u003c= idle; cnt_reg \u003c= 0; din_reg \u003c= 0; end else begin st_reg \u003c= st_nxt; cnt_reg \u003c= cnt_nxt; if(~cs)begin din_reg \u003c= {din_reg[width-2:0],sdo}; sdi \u003c= din_reg[width-1]; end end end endgenerate always_comb begin st_nxt = st_reg; din_nxt=din_reg; cnt_nxt=cnt_reg; case (st_reg) idle: begin if(~cs) st_nxt = sample; end sample: begin if(cnt_reg == width-1) cnt_nxt = 0; else cnt_nxt = cnt_reg + 1; end endcase end assign rx_dout = (cnt_reg == width-1) ? din_reg : 'h0; endmodule // Local Variables: // Verilog-Library-Directories: (\".\") // End: SPI Wrapper The SPI wrapper encapsulates the functionality of the SPI controller and peripheral, providing a standardized interface for users and applications.\n`timescale 1ns/1ns module spi #(parameter mode = 0, dvsr = 31, width = 8)(/*AUTOARG*/ // Outputs rx_vld, rx_dout, tx_dout, // Inputs clk, rst, din, tx_vld ); input clk; input rst; input [width-1:0] din; input\ttx_vld; output\trx_vld; output [width-1:0] rx_dout; output [width-1:0] tx_dout; /*AUTOREG*/ /*AUTOWIRE*/ // Beginning of automatic wires (for undeclared instantiated-module outputs) wire\tcs;\t// From MOD1 of spi_tx.v wire\tsdi;\t// From MOD1 of spi_rx.v wire\tsdo;\t// From MOD1 of spi_tx.v wire\tsclk;\t// From MOD1 of spi_tx.v wire\ttx_rdy;\t// From MOD1 of spi_tx.v // End of automatics spi_tx #(/*AUTOINSTPARAM*/ // Parameters .mode\t(mode), .dvsr\t(dvsr), .width\t(width)) SPI_MASTER (/*AUTOINST*/ // Outputs .sdo\t(sdo), .sclk\t(sclk), .cs\t(cs), .tx_dout\t(tx_dout[width-1:0]), .tx_rdy\t(tx_rdy), .rx_vld\t(rx_vld), .din\t(din[width-1:0]), // Inputs .sdi\t(sdi), .tx_vld\t(tx_vld), .rst\t(rst), .clk\t(clk)); spi_rx #(/*AUTOINSTPARAM*/ // Parameters .mode\t(mode), .width\t(width)) SPI_SLAVE (/*AUTOINST*/ // Outputs .sdi\t(sdi), .rx_dout\t(rx_dout[width-1:0]), // Inputs .sdo\t(sdo), .sclk\t(sclk), .cs\t(cs), .rst\t(rst), .clk\t(clk)); endmodule // Local Variables: // Verilog-Library-Directories: (\".\") // End: Testbench `timescale 1ns/1ns module tb_spi(); localparam t = 8; logic clk; logic rst; localparam mode = 3; localparam dvsr = 31; localparam width = 8; logic [width-1:0] din; logic tx_vld; /*AUTOREG*/ /*AUTOWIRE*/ // Beginning of automatic wires (for undeclared instantiated-module outputs) wire [width-1:0]\trx_dout;\t// From DUT of spi.v wire\trx_vld;\t// From DUT of spi.v wire [width-1:0]\ttx_dout;\t// From DUT of spi.v // End of automatics spi #(/*AUTOINSTPARAM*/ // Parameters .mode\t(mode), .dvsr\t(dvsr), .width\t(width)) DUT (/*AUTOINST*/ // Outputs .rx_vld\t(rx_vld), .rx_dout\t(rx_dout[width-1:0]), .tx_dout\t(tx_dout[width-1:0]), // Inputs .clk\t(clk), .rst\t(rst), .din\t(din[width-1:0]), .tx_vld\t(tx_vld)); always #(t/2) clk = (clk === 1'b0); initial begin rst = 1; din ='h95; tx_vld = 0; #(2*t); rst = 0; #(3*t); tx_vld = 1; wait(rx_vld); #(3*t); wait(rx_vld); $display(\"tx_dout = %0h and rx_dout = %0h\", tx_dout, rx_dout); if(tx_dout == rx_dout)begin $display(\"Simulation PASS ;)\"); $finish; end else begin $display(\"Simulation FAIL ;)\"); $finish; end end // initial begin initial begin $dumpfile(\"tb_spi.vcd\"); $dumpvars(0,tb_spi); end endmodule // Local Variables: // Verilog-Library-Directories: (\".\") // End: ",
  "wordCount" : "1957",
  "inLanguage": "en",
  "datePublished": "2024-09-18T22:25:00-04:00",
  "dateModified": "2024-09-18T22:25:00-04:00",
  "author":[{
    "@type": "Person",
    "name": "Kiran"
  }],
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://24x7fpga.com/rtl_directory/2024_09_18_22_25_40_spi/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Home",
    "logo": {
      "@type": "ImageObject",
      "url": "https://24x7fpga.com/favicon.ico"
    }
  }
}
</script><link rel="stylesheet" href="/css/syntax.css" !important>

</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    }

</script>


<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://24x7fpga.com/" accesskey="h" title="Home (Alt + H)">Home</a>
            
            
            <div class="vertical-line" style="height: 20px;"></div>
            
            
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://24x7fpga.com/rtl_directory/2024_06_05_00_21_53_rtl_design_directory" title="rtl">
                    <span> 


                           
                        
                         
                        rtl</span>  
                </a>
            </li>
            <li>
                <a href="https://24x7fpga.com/sv_directory/2024_06_27_16_53_00_sv_verification_directory" title="sv">
                    <span> 


                           
                        
                         
                        sv</span>  
                </a>
            </li>
            <li>
                <a href="https://24x7fpga.com/uvm_directory/2024_08_28_12_39_50_uvm_framework_directory" title="uvm">
                    <span> 


                           
                        
                         
                        uvm</span>  
                </a>
            </li>
            <li>
                <a href="https://24x7fpga.com/tags/" title="">
                    <span> 


                           
                        
                            
                    
                    
                    

                    
                    
                    

                    
                    
                    
                    


                    
                    
                    
                    

                    
                    
                    
                    
                    
                    
                    
                    
                
                         
                        
                        <div style="text-decoration: none">
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 15"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round" style="text-decoration: none">
                            <path d="M21 18V6H8L2 12L8 18H21Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M12 12C12 13.1046 11.1046 14 10 14C8.89543 14 8 13.1046 8 12C8 10.8954 8.89543 10 10 10C11.1046 10 12 10.8954 12 12Z" stroke="currentColor" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
                        <line x1="7" y1="7" x2="7" y2="7"></line>
                        </svg> 
                        </div>
                        </span>  
                </a>
            </li>
        </ul>
    </nav>
</header>







<script src="https://24x7fpga.com/js/mathjax-config.js"></script>


<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      SPI
    </h1>
    <div class="post-meta"><span title='2024-09-18 22:25:00 -0400 EDT'>September 18, 2024</span>&nbsp;·&nbsp;10 min&nbsp;·&nbsp;1957 words&nbsp;·&nbsp;Kiran

</div>
  </header> 
  <div class="post-content"><p><a href="https://github.com/24x7fpga/RTL/tree/master/rtl_designs/spi">Source</a> &ndash; <a href="/rtl_directory/2024_06_05_00_21_53_rtl_design_directory/">RTL Design Directory</a></p>
<h2 id="spi-overview">SPI: Overview<a hidden class="anchor" aria-hidden="true" href="#spi-overview">#</a></h2>
<p>The Serial Peripheral Interface (SPI) is a widely used communication protocol that enables microcontrollers to interact with external peripherals such as OLED displays, sensors, and SD cards. Known for its simplicity SPI facilitates efficient data exchange between devices in embedded systems.</p>
<p>SPI and <a href="/rtl_directory/2024_09_17_20_46_04_uart/">UART</a> are both serial communication protocols used to exchange data between peripheral devices, but they differ significantly in how they achieve synchronization. SPI is a synchronous protocol, meaning it relies on a shared clock signal to synchronize data transfer between the transmitter and receiver, ensuring precise timing. In contrast, UART is asynchronous, operating without a clock signal and instead relying on predefined transmission speeds and additional start and stop bits to maintain synchronization. This fundamental difference makes SPI more efficient for high-speed data transfer, while UART is simpler but more prone to timing mismatches and overhead.</p>
<figure>
    <img loading="lazy" src="/ox-hugo/spi_block.svg"
         alt="Figure 1: SPI Controller, Peripheral Connection"/> <figcaption>
            <p><span class="figure-number">Figure 1: </span>SPI Controller, Peripheral Connection</p>
        </figcaption>
</figure>

<ul>
<li><strong>Chip Select (CS)</strong>: This signal is active low and is used to initiate communication with the peripheral device.</li>
<li><strong>Serial Clock (SCK)</strong>: A clock signal generated by the controller to synchronize data transfer between the controller and the peripheral.</li>
<li><strong>Serial Data Out (SDO)</strong>: The data line used by the controller to send serial data to the peripheral device.</li>
<li><strong>Serial Data In (SDI)</strong>: The data line through which the peripheral sends serial data back to the controller.</li>
</ul>
<h3 id="spi-controller">SPI Controller<a hidden class="anchor" aria-hidden="true" href="#spi-controller">#</a></h3>
<p>An <code>SPI Controller</code> is a hardware module that manages communication between a master device (typically a microcontroller or processor) and one or more peripheral devices in an SPI (Serial Peripheral Interface) system. It controls the flow of data by generating the necessary signals for synchronization and data transfer. The SPI controller produces the <code>Serial Clock (SCK)</code>, which ensures that both the master and the peripheral are synchronized. It also controls the <code>Chip Select (CS)</code> signal, which activates the communication with a specific peripheral device, and manages the <code>Serial Data Out (SDO)</code> and <code>Serial Data In (SDI)</code> lines to transmit and receive data. The SPI interface can have only one controller, but may control multiple slaves. The controller&rsquo;s role is essential for efficient and reliable data exchange, as it ensures that all timing and signaling requirements are met for smooth communication.</p>
<h3 id="spi-peripheral">SPI Peripheral<a hidden class="anchor" aria-hidden="true" href="#spi-peripheral">#</a></h3>
<p>An <code>SPI Peripheral</code> is a device that communicates with the master controller over the SPI bus. It can be anything from sensors, displays, memory chips, to other microcontrollers. The peripheral is designed to respond to commands from the master by sending or receiving data through the <code>Serial Data In (SDI)</code> and <code>Serial Data Out (SDO)</code> lines. It is activated when the <code>Chip Select (CS)</code> signal from the master is pulled low, indicating the start of communication. The peripheral synchronizes data transfer with the master using the <code>Serial Clock (SCK)</code>, which is provided by the SPI controller. The SPI peripheral’s role is to either transmit data to the master or respond to data requests, depending on the operation, while ensuring accurate timing and signal integrity based on the clock and chip select signals.</p>
<h3 id="data-transfer">Data Transfer<a hidden class="anchor" aria-hidden="true" href="#data-transfer">#</a></h3>
<ul>
<li>
<p>The SPI protocol operates using a master-slave configuration, where the master (controller) device takes full control of the communication. The master generates the <code>Serial Clock (SCK)</code>, ensuring data transfer is perfectly synchronized with the connected peripheral devices.</p>
</li>
<li>
<p>Communication begins when the master pulls the <code>Chip Select (CS)</code> line low for the intended peripheral. This activates the specific peripheral, allowing data exchange to take place.</p>
</li>
<li>
<p>In systems with multiple peripherals, each device is typically assigned its own <code>CS</code> line, enabling the master to communicate with one device at a time by toggling the appropriate <code>CS</code> line.</p>
</li>
<li>
<p>SPI supports full-duplex communication, meaning data is transferred in both directions simultaneously. The master sends data to the peripheral via the <code>Serial Data Out (SDO)</code> line, while the peripheral responds with data through the <code>Serial Data In (SDI)</code> line. These data transfers occur in parallel, ensuring high-speed communication.</p>
</li>
<li>
<p>The synchronization of data is managed by the <code>SCK</code> signal generated by the master. Depending on the chosen communication mode, data is shifted in and out of devices on either the rising or falling edge of the clock signal.</p>
</li>
<li>
<p>Data is transferred in frames, with each frame consisting of a fixed number of bits, commonly 8 bits per byte. For every bit of data, the master sends a clock pulse, ensuring the data is read or written at precisely the right moment.</p>
</li>
</ul>
<h3 id="clock-phase-and-polarity">Clock Phase and Polarity<a hidden class="anchor" aria-hidden="true" href="#clock-phase-and-polarity">#</a></h3>
<p>The SPI interface provides four different clock modes for data transfer, providing a choice of clock phase (delay) and clock polarity (rising or falling edge).</p>
<div class="table-caption">
  <span class="table-number">Table 1:</span>
  Clock Mode
</div>
<table>
  <thead>
      <tr>
          <th>Clock Mode</th>
          <th>Clock Polarity (CPOL)</th>
          <th>Clock Phase (CPHA)</th>
          <th>Description</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Mode 0</td>
          <td>0</td>
          <td>0</td>
          <td>Data is output on the rising edge of the clock (SCK). Input data is latched on the falling edge of the clock.</td>
      </tr>
      <tr>
          <td>Mode 1</td>
          <td>0</td>
          <td>1</td>
          <td>Data is output one-half clock cycle before the first rising edge of SCK and subsequently on the falling edge. Input data is latched on the rising edge of the clock.</td>
      </tr>
      <tr>
          <td>Mode 2</td>
          <td>1</td>
          <td>0</td>
          <td>Data is output on the falling edge of the clock (SCK). Input data is latched on the rising edge of the clock.</td>
      </tr>
      <tr>
          <td>Mode 3</td>
          <td>1</td>
          <td>1</td>
          <td>Data is output one-half clock cycle before the first falling edge of SCK and subsequently on the rising edge. Input data is latched on the falling edge of the clock.</td>
      </tr>
  </tbody>
</table>
<p><code>Source</code>: <a href="https://www.ti.com/lit/ug/sprugp2a/sprugp2a.pdf">SPI User Guide</a></p>
<figure>
    <img loading="lazy" src="/ox-hugo/spi_clk_modes.svg"
         alt="Figure 2: Clock Modes"/> <figcaption>
            <p><span class="figure-number">Figure 2: </span>Clock Modes</p>
        </figcaption>
</figure>

<h3 id="spi-transmitter">SPI Transmitter<a hidden class="anchor" aria-hidden="true" href="#spi-transmitter">#</a></h3>
<p>The SPI transmitter is a key component of the SPI protocol, also known as SPI Controller, responsible for sending data from the master device to the peripheral. Its operation is synchronized with the <code>SPI clock (SCK)</code> to ensure accurate and efficient data transfer.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-verilog" data-lang="verilog"><span style="display:flex;"><span><span style="color:#66d9ef">`timescale</span> <span style="color:#ae81ff">1</span>ns<span style="color:#f92672">/</span><span style="color:#ae81ff">1</span>ns
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">module</span> spi_tx #(<span style="color:#66d9ef">parameter</span> mode <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, dvsr <span style="color:#f92672">=</span> <span style="color:#ae81ff">31</span>, width <span style="color:#f92672">=</span> <span style="color:#ae81ff">8</span>) (<span style="color:#75715e">/*AUTOARG*/</span>
</span></span><span style="display:flex;"><span>   <span style="color:#75715e">// Outputs
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>   sdo, sclk, cs, tx_dout, tx_rdy, rx_vld,
</span></span><span style="display:flex;"><span>   <span style="color:#75715e">// Inputs
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>   sdi, tx_vld, din, rst, clk
</span></span><span style="display:flex;"><span>   );
</span></span><span style="display:flex;"><span>   <span style="color:#75715e">//outputs
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>   <span style="color:#66d9ef">output</span> sdo;
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">output</span> sclk;
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">output</span> cs;
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">output</span> [width<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">0</span>] tx_dout;
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">output</span>	       tx_rdy;
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">output</span>	       rx_vld;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   <span style="color:#75715e">//input
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>   <span style="color:#66d9ef">input</span>	       sdi;
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">input</span>	       tx_vld;
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">input</span> [width<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">0</span>] din;
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">input</span>	       rst;
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">input</span>	       clk;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   <span style="color:#75715e">/*AUTOREG*/</span>
</span></span><span style="display:flex;"><span>   <span style="color:#75715e">// Beginning of automatic regs (for this module&#39;s undeclared outputs)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>   <span style="color:#66d9ef">reg</span>			rx_vld;
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">reg</span>			tx_rdy;
</span></span><span style="display:flex;"><span>   <span style="color:#75715e">// End of automatics
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>   <span style="color:#75715e">/*AUTOWIRE*/</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   <span style="color:#75715e">// fsm states
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>   <span style="color:#66d9ef">typedef</span> <span style="color:#66d9ef">enum</span> {idle, drive, sample} state_type;
</span></span><span style="display:flex;"><span>   state_type st_reg, st_nxt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">logic</span> [$clog2(dvsr)<span style="color:#f92672">:</span> <span style="color:#ae81ff">0</span>] dvsr_reg, dvsr_nxt;
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">logic</span> [width<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">0</span>]	   cnt_reg, cnt_nxt;
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">logic</span>		   cpol, cpha;
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">logic</span>		   temp_clk, sclk_reg, sclk_nxt;
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">logic</span>		   cs_reg, cs_nxt;
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">logic</span> [width<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span>]	   sdo_reg, sdo_nxt;
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">logic</span> [width<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span>]	   sdi_reg, sdi_nxt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   <span style="color:#75715e">// spi mode decoder
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>   <span style="color:#66d9ef">always_comb</span> <span style="color:#66d9ef">begin</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">case</span>(mode)
</span></span><span style="display:flex;"><span>        <span style="color:#ae81ff">&#39;h0</span> <span style="color:#f92672">:</span> <span style="color:#66d9ef">begin</span>
</span></span><span style="display:flex;"><span>           cpol <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>           cpha <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#ae81ff">&#39;h1</span> <span style="color:#f92672">:</span> <span style="color:#66d9ef">begin</span>
</span></span><span style="display:flex;"><span>           cpol <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>           cpha <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#ae81ff">&#39;h2</span> <span style="color:#f92672">:</span> <span style="color:#66d9ef">begin</span>
</span></span><span style="display:flex;"><span>           cpol <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>           cpha <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#ae81ff">&#39;h3</span> <span style="color:#f92672">:</span> <span style="color:#66d9ef">begin</span>
</span></span><span style="display:flex;"><span>           cpol <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>           cpha <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">endcase</span> <span style="color:#75715e">// case (mode)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>   <span style="color:#66d9ef">end</span> <span style="color:#75715e">// always_comb
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">always_ff</span>@(<span style="color:#66d9ef">posedge</span> clk)
</span></span><span style="display:flex;"><span>     <span style="color:#66d9ef">if</span>(rst)<span style="color:#66d9ef">begin</span>
</span></span><span style="display:flex;"><span>        st_reg   <span style="color:#f92672">&lt;=</span> idle;
</span></span><span style="display:flex;"><span>        cnt_reg  <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>        dvsr_reg <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>        sclk_reg <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>        sdo_reg  <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>        sdi_reg  <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>        cs_reg   <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>     <span style="color:#66d9ef">end</span> <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">begin</span>
</span></span><span style="display:flex;"><span>        st_reg   <span style="color:#f92672">&lt;=</span> st_nxt;
</span></span><span style="display:flex;"><span>        cnt_reg  <span style="color:#f92672">&lt;=</span> cnt_nxt;
</span></span><span style="display:flex;"><span>        dvsr_reg <span style="color:#f92672">&lt;=</span> dvsr_nxt;
</span></span><span style="display:flex;"><span>        sclk_reg <span style="color:#f92672">&lt;=</span> sclk_nxt;
</span></span><span style="display:flex;"><span>        sdo_reg  <span style="color:#f92672">&lt;=</span> sdo_nxt;
</span></span><span style="display:flex;"><span>        sdi_reg  <span style="color:#f92672">&lt;=</span> sdi_nxt;
</span></span><span style="display:flex;"><span>        cs_reg   <span style="color:#f92672">&lt;=</span> cs_nxt;
</span></span><span style="display:flex;"><span>     <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">always_comb</span> <span style="color:#66d9ef">begin</span>
</span></span><span style="display:flex;"><span>      st_nxt   <span style="color:#f92672">=</span> st_reg;
</span></span><span style="display:flex;"><span>      cnt_nxt  <span style="color:#f92672">=</span> cnt_reg;
</span></span><span style="display:flex;"><span>      dvsr_nxt <span style="color:#f92672">=</span> dvsr_reg;
</span></span><span style="display:flex;"><span>      sdo_nxt  <span style="color:#f92672">=</span> sdo_reg;
</span></span><span style="display:flex;"><span>      cs_nxt   <span style="color:#f92672">=</span> cs_reg;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      rx_vld   <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">case</span>(st_reg)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        idle: <span style="color:#66d9ef">begin</span>
</span></span><span style="display:flex;"><span>           <span style="color:#66d9ef">if</span>(tx_vld)<span style="color:#66d9ef">begin</span>
</span></span><span style="display:flex;"><span>              cs_nxt <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>              dvsr_nxt <span style="color:#f92672">=</span> dvsr_reg <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>              <span style="color:#66d9ef">if</span>(dvsr_reg <span style="color:#f92672">==</span> dvsr)<span style="color:#66d9ef">begin</span>
</span></span><span style="display:flex;"><span>                      st_nxt <span style="color:#f92672">=</span> drive;
</span></span><span style="display:flex;"><span>                      dvsr_nxt <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>              <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>           <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        drive: <span style="color:#66d9ef">begin</span>
</span></span><span style="display:flex;"><span>           sdo_nxt <span style="color:#f92672">=</span> din <span style="color:#f92672">&lt;&lt;</span> cnt_reg;
</span></span><span style="display:flex;"><span>           dvsr_nxt <span style="color:#f92672">=</span> dvsr_reg <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>           <span style="color:#66d9ef">if</span>(dvsr_reg <span style="color:#f92672">==</span> dvsr)<span style="color:#66d9ef">begin</span>
</span></span><span style="display:flex;"><span>              st_nxt <span style="color:#f92672">=</span> sample;
</span></span><span style="display:flex;"><span>              dvsr_nxt <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>           <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        sample: <span style="color:#66d9ef">begin</span>
</span></span><span style="display:flex;"><span>           <span style="color:#75715e">// read sdi
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>           sdi_nxt[width<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">-</span>cnt_reg] <span style="color:#f92672">=</span> sdi;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>           dvsr_nxt <span style="color:#f92672">=</span> dvsr_reg <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>           <span style="color:#66d9ef">if</span>(dvsr_reg <span style="color:#f92672">==</span> dvsr)<span style="color:#66d9ef">begin</span>
</span></span><span style="display:flex;"><span>              cnt_nxt <span style="color:#f92672">=</span> cnt_reg <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>              dvsr_nxt <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>              <span style="color:#66d9ef">if</span>(cnt_reg <span style="color:#f92672">==</span> width<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>) <span style="color:#66d9ef">begin</span>
</span></span><span style="display:flex;"><span>                      cnt_nxt <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>                      rx_vld  <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>                      <span style="color:#66d9ef">if</span>(<span style="color:#f92672">~</span>tx_vld)
</span></span><span style="display:flex;"><span>                          st_nxt  <span style="color:#f92672">=</span> idle;
</span></span><span style="display:flex;"><span>                  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>                      st_nxt <span style="color:#f92672">=</span> drive;
</span></span><span style="display:flex;"><span>                  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">endcase</span> <span style="color:#75715e">// case (st_reg)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>   <span style="color:#66d9ef">end</span> <span style="color:#75715e">// always_comb
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>   <span style="color:#75715e">// look-ahead decoder
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>   <span style="color:#66d9ef">assign</span> temp_clk <span style="color:#f92672">=</span> (st_nxt <span style="color:#f92672">==</span> drive <span style="color:#f92672">&amp;&amp;</span> cpha) <span style="color:#f92672">||</span> (st_nxt <span style="color:#f92672">==</span> sample <span style="color:#f92672">&amp;&amp;</span> <span style="color:#f92672">~</span>cpha);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   <span style="color:#75715e">// spi clk
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>   <span style="color:#66d9ef">assign</span> sclk_nxt <span style="color:#f92672">=</span> (cpol) <span style="color:#f92672">?</span> <span style="color:#f92672">~</span>temp_clk <span style="color:#f92672">:</span> temp_clk;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   <span style="color:#75715e">// registered data
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>   <span style="color:#66d9ef">assign</span> cs   <span style="color:#f92672">=</span> cs_reg;
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">assign</span> sclk <span style="color:#f92672">=</span> sclk_reg;
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">assign</span> sdo  <span style="color:#f92672">=</span> sdo_reg[width<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">assign</span> tx_dout <span style="color:#f92672">=</span> sdi_reg;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">endmodule</span> <span style="color:#75715e">// spi_tx
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// Local Variables:
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// Verilog-Library-Directories: (&#34;.&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// End:
</span></span></span></code></pre></div><h3 id="spi-receiver">SPI Receiver<a hidden class="anchor" aria-hidden="true" href="#spi-receiver">#</a></h3>
<p>The SPI receiver is the peripheral device in an SPI communication system responsible for receiving data from the master device. It works in synchronization with the master by relying on the clock signal (SCK) generated by the master for precise timing.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-verilog" data-lang="verilog"><span style="display:flex;"><span><span style="color:#66d9ef">`timescale</span> <span style="color:#ae81ff">1</span>ns<span style="color:#f92672">/</span><span style="color:#ae81ff">1</span>ns
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">module</span> spi_rx #(<span style="color:#66d9ef">parameter</span> mode <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, width <span style="color:#f92672">=</span> <span style="color:#ae81ff">8</span>) (<span style="color:#75715e">/*AUTOARG*/</span>
</span></span><span style="display:flex;"><span>   <span style="color:#75715e">// Outputs
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>   sdi, rx_dout,
</span></span><span style="display:flex;"><span>   <span style="color:#75715e">// Inputs
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>   sdo, sclk, cs, rst, clk
</span></span><span style="display:flex;"><span>   );
</span></span><span style="display:flex;"><span>   <span style="color:#75715e">// outputs
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>   <span style="color:#66d9ef">output</span> sdi;
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">output</span> [width<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span>] rx_dout;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   <span style="color:#75715e">//input
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>   <span style="color:#66d9ef">input</span>	      sdo;
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">input</span>	      sclk;
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">input</span>	      cs;
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">input</span>	      rst;
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">input</span>	      clk;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   <span style="color:#75715e">/*AUTOREG*/</span>
</span></span><span style="display:flex;"><span>   <span style="color:#75715e">// Beginning of automatic regs (for this module&#39;s undeclared outputs)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>   <span style="color:#66d9ef">reg</span>			sdi;
</span></span><span style="display:flex;"><span>   <span style="color:#75715e">// End of automatics
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>   <span style="color:#75715e">/*AUTOWIRE*/</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   <span style="color:#75715e">// fsm states
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>   <span style="color:#66d9ef">typedef</span> <span style="color:#66d9ef">enum</span> {idle, sample} state_type;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   state_type st_reg, st_nxt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">logic</span> [width<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span>]	  cnt_reg, cnt_nxt;
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">logic</span> [width<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span>]	  din_reg, din_nxt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">generate</span>
</span></span><span style="display:flex;"><span>     <span style="color:#66d9ef">if</span>(mode <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">||</span> mode <span style="color:#f92672">==</span> <span style="color:#ae81ff">3</span>)<span style="color:#66d9ef">begin</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">always_ff</span>@(<span style="color:#66d9ef">posedge</span> sclk, <span style="color:#66d9ef">posedge</span> rst)
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">if</span>(rst)<span style="color:#66d9ef">begin</span>
</span></span><span style="display:flex;"><span>             st_reg <span style="color:#f92672">&lt;=</span> idle;
</span></span><span style="display:flex;"><span>             cnt_reg <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>             din_reg <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">end</span> <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">begin</span>
</span></span><span style="display:flex;"><span>             st_reg <span style="color:#f92672">&lt;=</span> st_nxt;
</span></span><span style="display:flex;"><span>             cnt_reg  <span style="color:#f92672">&lt;=</span> cnt_nxt;
</span></span><span style="display:flex;"><span>             <span style="color:#66d9ef">if</span>(<span style="color:#f92672">~</span>cs)<span style="color:#66d9ef">begin</span>
</span></span><span style="display:flex;"><span>                din_reg <span style="color:#f92672">&lt;=</span> {din_reg[width<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span>],sdo};
</span></span><span style="display:flex;"><span>                sdi <span style="color:#f92672">&lt;=</span> din_reg[width<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>             <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>     <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>     <span style="color:#66d9ef">if</span>(mode <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">||</span> mode <span style="color:#f92672">==</span> <span style="color:#ae81ff">2</span>)<span style="color:#66d9ef">begin</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">always_ff</span>@(<span style="color:#66d9ef">negedge</span> sclk, <span style="color:#66d9ef">posedge</span> rst)
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">if</span>(rst)<span style="color:#66d9ef">begin</span>
</span></span><span style="display:flex;"><span>             st_reg  <span style="color:#f92672">&lt;=</span> idle;
</span></span><span style="display:flex;"><span>             cnt_reg <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>             din_reg <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">end</span> <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">begin</span>
</span></span><span style="display:flex;"><span>             st_reg  <span style="color:#f92672">&lt;=</span> st_nxt;
</span></span><span style="display:flex;"><span>             cnt_reg <span style="color:#f92672">&lt;=</span> cnt_nxt;
</span></span><span style="display:flex;"><span>             <span style="color:#66d9ef">if</span>(<span style="color:#f92672">~</span>cs)<span style="color:#66d9ef">begin</span>
</span></span><span style="display:flex;"><span>                din_reg <span style="color:#f92672">&lt;=</span> {din_reg[width<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span>],sdo};
</span></span><span style="display:flex;"><span>                sdi     <span style="color:#f92672">&lt;=</span> din_reg[width<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>             <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>     <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">endgenerate</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">always_comb</span> <span style="color:#66d9ef">begin</span>
</span></span><span style="display:flex;"><span>      st_nxt <span style="color:#f92672">=</span> st_reg;
</span></span><span style="display:flex;"><span>      din_nxt<span style="color:#f92672">=</span>din_reg;
</span></span><span style="display:flex;"><span>      cnt_nxt<span style="color:#f92672">=</span>cnt_reg;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">case</span> (st_reg)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      idle: <span style="color:#66d9ef">begin</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span>(<span style="color:#f92672">~</span>cs)
</span></span><span style="display:flex;"><span>                st_nxt <span style="color:#f92672">=</span> sample;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      sample: <span style="color:#66d9ef">begin</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span>(cnt_reg <span style="color:#f92672">==</span> width<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>                cnt_nxt <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>                cnt_nxt <span style="color:#f92672">=</span> cnt_reg <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">endcase</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">assign</span> rx_dout <span style="color:#f92672">=</span> (cnt_reg <span style="color:#f92672">==</span> width<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>) <span style="color:#f92672">?</span> din_reg <span style="color:#f92672">:</span> <span style="color:#ae81ff">&#39;h0</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">endmodule</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Local Variables:
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// Verilog-Library-Directories: (&#34;.&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// End:
</span></span></span></code></pre></div><h3 id="spi-wrapper">SPI Wrapper<a hidden class="anchor" aria-hidden="true" href="#spi-wrapper">#</a></h3>
<p>The SPI wrapper encapsulates the functionality of the SPI controller and peripheral, providing a standardized interface for users and applications.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-verilog" data-lang="verilog"><span style="display:flex;"><span><span style="color:#66d9ef">`timescale</span> <span style="color:#ae81ff">1</span>ns<span style="color:#f92672">/</span><span style="color:#ae81ff">1</span>ns
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">module</span> spi #(<span style="color:#66d9ef">parameter</span> mode <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, dvsr <span style="color:#f92672">=</span> <span style="color:#ae81ff">31</span>, width <span style="color:#f92672">=</span> <span style="color:#ae81ff">8</span>)(<span style="color:#75715e">/*AUTOARG*/</span>
</span></span><span style="display:flex;"><span>   <span style="color:#75715e">// Outputs
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>   rx_vld, rx_dout, tx_dout,
</span></span><span style="display:flex;"><span>   <span style="color:#75715e">// Inputs
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>   clk, rst, din, tx_vld
</span></span><span style="display:flex;"><span>   );
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">input</span>  clk;
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">input</span>  rst;
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">input</span> [width<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span>] din;
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">input</span>	     tx_vld;
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">output</span>	     rx_vld;
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">output</span> [width<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span>] rx_dout;
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">output</span> [width<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span>] tx_dout;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">/*AUTOREG*/</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">/*AUTOWIRE*/</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Beginning of automatic wires (for undeclared instantiated-module outputs)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">wire</span>			cs;			<span style="color:#75715e">// From MOD1 of spi_tx.v
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">wire</span>			sdi;			<span style="color:#75715e">// From MOD1 of spi_rx.v
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">wire</span>			sdo;			<span style="color:#75715e">// From MOD1 of spi_tx.v
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">wire</span>			sclk;			<span style="color:#75715e">// From MOD1 of spi_tx.v
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">wire</span>			tx_rdy;			<span style="color:#75715e">// From MOD1 of spi_tx.v
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#75715e">// End of automatics
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>spi_tx #(<span style="color:#75715e">/*AUTOINSTPARAM*/</span>
</span></span><span style="display:flex;"><span>         <span style="color:#75715e">// Parameters
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>         .mode				(mode),
</span></span><span style="display:flex;"><span>         .dvsr				(dvsr),
</span></span><span style="display:flex;"><span>         .width				(width)) SPI_MASTER (<span style="color:#75715e">/*AUTOINST*/</span>
</span></span><span style="display:flex;"><span>                                                       <span style="color:#75715e">// Outputs
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                                                       .sdo		(sdo),
</span></span><span style="display:flex;"><span>                                                       .sclk		(sclk),
</span></span><span style="display:flex;"><span>                                                       .cs		(cs),
</span></span><span style="display:flex;"><span>                                                       .tx_dout		(tx_dout[width<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span>]),
</span></span><span style="display:flex;"><span>                                                       .tx_rdy		(tx_rdy),
</span></span><span style="display:flex;"><span>                                                       .rx_vld		(rx_vld),
</span></span><span style="display:flex;"><span>                                                       .din		(din[width<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span>]),
</span></span><span style="display:flex;"><span>                                                       <span style="color:#75715e">// Inputs
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                                                       .sdi		(sdi),
</span></span><span style="display:flex;"><span>                                                       .tx_vld		(tx_vld),
</span></span><span style="display:flex;"><span>                                                       .rst		(rst),
</span></span><span style="display:flex;"><span>                                                       .clk		(clk));
</span></span><span style="display:flex;"><span>spi_rx #(<span style="color:#75715e">/*AUTOINSTPARAM*/</span>
</span></span><span style="display:flex;"><span>         <span style="color:#75715e">// Parameters
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>         .mode				(mode),
</span></span><span style="display:flex;"><span>         .width				(width)) SPI_SLAVE (<span style="color:#75715e">/*AUTOINST*/</span>
</span></span><span style="display:flex;"><span>                                                       <span style="color:#75715e">// Outputs
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                                                       .sdi		(sdi),
</span></span><span style="display:flex;"><span>                                                       .rx_dout		(rx_dout[width<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span>]),
</span></span><span style="display:flex;"><span>                                                       <span style="color:#75715e">// Inputs
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                                                       .sdo		(sdo),
</span></span><span style="display:flex;"><span>                                                       .sclk		(sclk),
</span></span><span style="display:flex;"><span>                                                       .cs		(cs),
</span></span><span style="display:flex;"><span>                                                       .rst		(rst),
</span></span><span style="display:flex;"><span>                                                       .clk		(clk));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">endmodule</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Local Variables:
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// Verilog-Library-Directories: (&#34;.&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// End:
</span></span></span></code></pre></div><h3 id="testbench">Testbench<a hidden class="anchor" aria-hidden="true" href="#testbench">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-verilog" data-lang="verilog"><span style="display:flex;"><span><span style="color:#66d9ef">`timescale</span> <span style="color:#ae81ff">1</span>ns<span style="color:#f92672">/</span><span style="color:#ae81ff">1</span>ns
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">module</span> tb_spi();
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">localparam</span> t <span style="color:#f92672">=</span> <span style="color:#ae81ff">8</span>;
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">logic</span>      clk;
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">logic</span>      rst;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">localparam</span> mode  <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>;
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">localparam</span> dvsr  <span style="color:#f92672">=</span> <span style="color:#ae81ff">31</span>;
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">localparam</span> width <span style="color:#f92672">=</span> <span style="color:#ae81ff">8</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">logic</span> [width<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span>] din;
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">logic</span>             tx_vld;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   <span style="color:#75715e">/*AUTOREG*/</span>
</span></span><span style="display:flex;"><span>   <span style="color:#75715e">/*AUTOWIRE*/</span>
</span></span><span style="display:flex;"><span>   <span style="color:#75715e">// Beginning of automatic wires (for undeclared instantiated-module outputs)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>   <span style="color:#66d9ef">wire</span> [width<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span>]	rx_dout;		<span style="color:#75715e">// From DUT of spi.v
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>   <span style="color:#66d9ef">wire</span>			rx_vld;			<span style="color:#75715e">// From DUT of spi.v
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>   <span style="color:#66d9ef">wire</span> [width<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span>]	tx_dout;		<span style="color:#75715e">// From DUT of spi.v
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>   <span style="color:#75715e">// End of automatics
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>   spi #(<span style="color:#75715e">/*AUTOINSTPARAM*/</span>
</span></span><span style="display:flex;"><span>         <span style="color:#75715e">// Parameters
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>         .mode				(mode),
</span></span><span style="display:flex;"><span>         .dvsr				(dvsr),
</span></span><span style="display:flex;"><span>         .width				(width)) DUT (<span style="color:#75715e">/*AUTOINST*/</span>
</span></span><span style="display:flex;"><span>                                                      <span style="color:#75715e">// Outputs
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                                                      .rx_vld		(rx_vld),
</span></span><span style="display:flex;"><span>                                                      .rx_dout		(rx_dout[width<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span>]),
</span></span><span style="display:flex;"><span>                                                      .tx_dout		(tx_dout[width<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span>]),
</span></span><span style="display:flex;"><span>                                                      <span style="color:#75715e">// Inputs
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                                                      .clk		(clk),
</span></span><span style="display:flex;"><span>                                                      .rst		(rst),
</span></span><span style="display:flex;"><span>                                                      .din		(din[width<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span>]),
</span></span><span style="display:flex;"><span>                                                      .tx_vld		(tx_vld));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">always</span> #(t<span style="color:#f92672">/</span><span style="color:#ae81ff">2</span>) clk <span style="color:#f92672">=</span> (clk <span style="color:#f92672">===</span> <span style="color:#ae81ff">1</span><span style="color:#ae81ff">&#39;b0</span>);
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">initial</span> <span style="color:#66d9ef">begin</span>
</span></span><span style="display:flex;"><span>      rst <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>      din <span style="color:#f92672">=</span><span style="color:#ae81ff">&#39;h95</span>;
</span></span><span style="display:flex;"><span>      tx_vld <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>      #(<span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>t);
</span></span><span style="display:flex;"><span>      rst <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>      #(<span style="color:#ae81ff">3</span><span style="color:#f92672">*</span>t);
</span></span><span style="display:flex;"><span>      tx_vld <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">wait</span>(rx_vld);
</span></span><span style="display:flex;"><span>      #(<span style="color:#ae81ff">3</span><span style="color:#f92672">*</span>t);
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">wait</span>(rx_vld);
</span></span><span style="display:flex;"><span>      $display(<span style="color:#e6db74">&#34;tx_dout = %0h and rx_dout = %0h&#34;</span>, tx_dout, rx_dout);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span>(tx_dout <span style="color:#f92672">==</span> rx_dout)<span style="color:#66d9ef">begin</span>
</span></span><span style="display:flex;"><span>           $display(<span style="color:#e6db74">&#34;Simulation PASS ;)&#34;</span>);
</span></span><span style="display:flex;"><span>           $finish;
</span></span><span style="display:flex;"><span>         <span style="color:#66d9ef">end</span> <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">begin</span>
</span></span><span style="display:flex;"><span>       $display(<span style="color:#e6db74">&#34;Simulation FAIL ;)&#34;</span>);
</span></span><span style="display:flex;"><span>           $finish;
</span></span><span style="display:flex;"><span>         <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">end</span> <span style="color:#75715e">// initial begin
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">initial</span> <span style="color:#66d9ef">begin</span>
</span></span><span style="display:flex;"><span>      $dumpfile(<span style="color:#e6db74">&#34;tb_spi.vcd&#34;</span>);
</span></span><span style="display:flex;"><span>      $dumpvars(<span style="color:#ae81ff">0</span>,tb_spi);
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">endmodule</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Local Variables:
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// Verilog-Library-Directories: (&#34;.&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// End:
</span></span></span></code></pre></div>

  </div>



  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://24x7fpga.com/tags/rtl/">Rtl</a></li>
    </ul>



    <div class="bottom-line" ></div>
    
    
    
      <img src="/img/org_mode.png" class="center" alt="footer" style="max-width:50px" />
    

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2026 <a href="https://24x7fpga.com/"></a></span>
        
        


</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a><footer class="footer">

</footer>



<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
