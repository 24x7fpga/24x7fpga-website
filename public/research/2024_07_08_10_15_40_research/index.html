<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Research | Home</title>
<meta name="keywords" content="">
<meta name="description" content="[Dissertation] &ndash; [RFSoC]
My doctroal research concentrates on designing a wideband digital receiver system to receive and process the data for accurate multiple signal detection. Fast Fourier transform (FFT) is a widely used digital signal processing technique to detect signals in a bandwidth. However, there are some limitations when using the FFT algorithm for signal detection
The number of fixed-length samples used by the FFT algorithm determines the frequency resolution. The number of samples from the input signal must be increased to increase the frequency resolution.">
<meta name="author" content="Kiran">
<link rel="canonical" href="https://24x7fpga.com/research/2024_07_08_10_15_40_research/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.3f0334ec81ff2929689e5ba14db83d816d01c99899fc4a9f2a4cec3d1682932a.css" integrity="sha256-PwM07IH/KSlonluhTbg9gW0ByZiZ/EqfKkzsPRaCkyo=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://24x7fpga.com/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://24x7fpga.com/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://24x7fpga.com/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://24x7fpga.com/apple-touch-icon.png">
<link rel="mask-icon" href="https://24x7fpga.com/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript>

<link rel="stylesheet" href="../../zcustom.css">

<meta property="og:title" content="Research" />
<meta property="og:description" content="[Dissertation] &ndash; [RFSoC]
My doctroal research concentrates on designing a wideband digital receiver system to receive and process the data for accurate multiple signal detection. Fast Fourier transform (FFT) is a widely used digital signal processing technique to detect signals in a bandwidth. However, there are some limitations when using the FFT algorithm for signal detection
The number of fixed-length samples used by the FFT algorithm determines the frequency resolution. The number of samples from the input signal must be increased to increase the frequency resolution." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://24x7fpga.com/research/2024_07_08_10_15_40_research/" /><meta property="article:section" content="research" />
<meta property="article:published_time" content="2024-07-08T10:15:00-04:00" />
<meta property="article:modified_time" content="2024-07-08T10:15:00-04:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Research"/>
<meta name="twitter:description" content="[Dissertation] &ndash; [RFSoC]
My doctroal research concentrates on designing a wideband digital receiver system to receive and process the data for accurate multiple signal detection. Fast Fourier transform (FFT) is a widely used digital signal processing technique to detect signals in a bandwidth. However, there are some limitations when using the FFT algorithm for signal detection
The number of fixed-length samples used by the FFT algorithm determines the frequency resolution. The number of samples from the input signal must be increased to increase the frequency resolution."/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Researches",
      "item": "https://24x7fpga.com/research/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Research",
      "item": "https://24x7fpga.com/research/2024_07_08_10_15_40_research/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Research",
  "name": "Research",
  "description": "[Dissertation] \u0026ndash; [RFSoC]\nMy doctroal research concentrates on designing a wideband digital receiver system to receive and process the data for accurate multiple signal detection. Fast Fourier transform (FFT) is a widely used digital signal processing technique to detect signals in a bandwidth. However, there are some limitations when using the FFT algorithm for signal detection\nThe number of fixed-length samples used by the FFT algorithm determines the frequency resolution. The number of samples from the input signal must be increased to increase the frequency resolution.",
  "keywords": [
    
  ],
  "articleBody": "[Dissertation] – [RFSoC]\nMy doctroal research concentrates on designing a wideband digital receiver system to receive and process the data for accurate multiple signal detection. Fast Fourier transform (FFT) is a widely used digital signal processing technique to detect signals in a bandwidth. However, there are some limitations when using the FFT algorithm for signal detection\nThe number of fixed-length samples used by the FFT algorithm determines the frequency resolution. The number of samples from the input signal must be increased to increase the frequency resolution. Increasing the number of samples for FFT calculations may increase the frequency resolution but increases the complexity of the algorithm. Signal detection becomes much more difficult in the presence of noise and interference. Since the FFT algorithm assumes that the fixed-length samples are periodic, in reality, the starting and ending position of fixed lengths of data is not the same, making the signal non-periodic, which leads to spectral leakage and false signal detection in the presence of noise. Limited hardware resource that provides maximum accuracy for signal detection poses a significant design challenge to the engineer. The research provides a hardware efficient algorithm to implement the FFT technique for accurate signal detection\nHardware Setup The overall hardware setup for FFT analysis is shown in figure below. The hardware setup begins with a signal source, Tektronix 5200, with the addition of White Gaussian noise. The signal generator is source for the input signal and clock frequency for the analog-to-digital (ADC) present on Zynq UltraScale+ RFSoC 1275. The RF Power combiner is utilized to combine two or more signals for multiple signal detection.\nDesign Flow Matlab and Xilinx Model Composer tool sets are employed to design, simulate and verify the functionality of the proposed digital receiver. The top-down approach for the implementation is shown in the flowchat which illustrates a general design approach undertaken to design the wideband receiver. Matlab results are used as a golden reference to verify the proposed FFT hardware. The digital wideband receiver is designed and simulated using Model Composer (Previously known as System Generator).\nFFT Core Designed and Tested in Xilinx Model Composer Figure shows the design of the FFT processor in Model Composer used for simulation.\nImplementing the FFT algorithm in hardware comes with its own set of challenges due to the complexity of the algorithm and the requirements of real-time processing. Here are some of the key challenges involved in FFT hardware implementation and hardware optimization to overcome:\nAlgorithm complexity: Multiplication operations were replaced by shift and add method to reduce complexity, increase speed, and introduce parallelism.\nFixed-point arithmetic: Dynamic Kernel function algorithm is an extension for fixed-point kernel where the unit circle is expanded by higher powers of two.\nNumerical precision and accuracy: The FFT algorithm involves repeated numerical operations, which increases the word length at every stage, [Multiple Input Selection (MIS)] scheme is implemented to maintain precision accuracy while quantizing the output to a specific length at each stage.\nMagnitude and peak detector: Both the magnitude estimator and peak detector are valuable tools for understanding the spectral content of a signal. Chebyshev coefficients and an advanced peak detector algorithm are implemented for accurate signal detection.\nParallelism and pipelining: The FFT algorithm naturally lends itself to parallel processing, essential for achieving high throughput in hardware implementations. Designing an efficient parallel architecture and managing the data flow through different processing stages is feasible with Xilinx Model Composer.\nDual Channel FFT Processor Multiplication complexity is reduced with the implementation of shift-and-add operation in the butterfly block. Multiple Input Selection (MIS) is a technique used to scale weak signals appropriately and maintain constant word length when data flows through the FFT stages. [Chebyshev coefficient for square root approximation] for calculating the magnitude of the FFT output. Single channel FFT shows significant improvements resulting with the lowest detectable signal strength is 500 uVpp. Single signal dynamic range (DR) is about 51 dB and maximum two-tone instantaneous dynamic range (IDR) is around 37 dB. A frame-based dual-channel FFT approach desogend for the detection of three signals with a minimum separation of three frequency bin (11.72MHz). [Enchanced signal detection] algorithm for multiple signal detection. The proposed method incorporates a frequency detection scheme comprising three peak detection blocks, including intermittent harmonic filtering blocks. This configuration ensures the capability to detect both strong and weak signals, relying solely on the primary channel, as long as the distance between the closest peaks is a minimum of four frequency bins (15.625MHz). To enhance signal detection robustness, we utilize differences between peaks identified in primary and auxiliary channels. This strategy reduces false alarms without a predefined threshold, enabling peak identification with a minimum separation of three frequency bins (11.72MHz) and a minimum signal strength of 40mVpp. The implemented design achieves exceptional performance, maintaining accurate detection rate for three signals across eight distinct test scenarios with varying strengths. This highlights the effectiveness of our approach in reliably detecting signals with diverse magnitudes and frequency separations.\nThe proposed method can detect two signals at least three frequency bins apart. Two strong signals and two weak signals can be detected with less complication. The complication arises when a weak signal is located close to a strong one. The proposed method utilizes the primary and auxiliary channel output to make a decision in selecting the correct frequency location. The frequency bin location is utilized to calculate the frequency. Figure below shows the magnitude spectrum of three signals where the two strong signals are placed far apart and the weak signal is placed close to strong one. Applying the enchanded signal detection algorithm, the detected signals are at located bin location 78, 81 and 210. The two extreme peaks that are place far apart are at bin location 78 and 210 are detected by the primary channel. To detect the third signal, the FFT magnitude spectrum from the auxiliary channel is analyzed and used by the enchanded signal detection algorithm to detected the third signal at bin location 81.\nPublications “Advancing Two-Signal Dynamic Range: A Digital Wideband Receiver for Enhanced Signal Detection.” (Under Review) “Enhanced Radar Multiple Signal Detection Dual-Channel Multiple Time Frame Fast Fourier Transform Performance in Wideband Receivers.” (Under Review) “Optimized Square Root Approximation using Chebyshev Coefficients for Fast Fourier Transform Performance in Wideband Receivers.” (Under Review) “Enhanced Wideband Frequency Estimation via FFT: Leveraging Polynomial Interpolation and Array Indexing.” Journal of Computer and Communications 12, no. 01 (2024). ",
  "wordCount" : "1066",
  "inLanguage": "en",
  "datePublished": "2024-07-08T10:15:00-04:00",
  "dateModified": "2024-07-08T10:15:00-04:00",
  "author":[{
    "@type": "Person",
    "name": "Kiran"
  }],
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://24x7fpga.com/research/2024_07_08_10_15_40_research/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Home",
    "logo": {
      "@type": "ImageObject",
      "url": "https://24x7fpga.com/favicon.ico"
    }
  }
}
</script><link rel="stylesheet" href="/css/syntax.css" !important>

</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    }

</script>


<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://24x7fpga.com/" accesskey="h" title="Home (Alt + H)">Home</a>
            
            
            <div class="vertical-line" style="height: 20px;"></div>
            
            
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://24x7fpga.com/about/about" title="about">
                    <span> 


                           
                        
                         
                        about</span>  
                </a>
            </li>
            <li>
                <a href="https://24x7fpga.com/research/2024_07_08_10_15_40_research" title="research">
                    <span class="active"> 


                           
                        
                         
                        research</span>  
                </a>
            </li>
            <li>
                <a href="https://24x7fpga.com/rtl_directory/2024_06_05_00_21_53_rtl_design_directory" title="rtl directory">
                    <span> 


                           
                        
                         
                        rtl directory</span>  
                </a>
            </li>
            <li>
                <a href="https://24x7fpga.com/sv_directory/2024_06_27_16_53_00_sv_verification_directory" title="sv directory">
                    <span> 


                           
                        
                         
                        sv directory</span>  
                </a>
            </li>
            <li>
                <a href="https://24x7fpga.com/tags/" title="">
                    <span> 


                           
                        
                            
                    
                    
                    

                    
                    
                    

                    
                    
                    
                    


                    
                    
                    
                    

                    
                    
                    
                    
                    
                    
                    
                    
                
                         
                        
                        <div style="text-decoration: none">
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 20"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round" style="text-decoration: none">
                            <path d="M21 18V6H8L2 12L8 18H21Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M12 12C12 13.1046 11.1046 14 10 14C8.89543 14 8 13.1046 8 12C8 10.8954 8.89543 10 10 10C11.1046 10 12 10.8954 12 12Z" stroke="currentColor" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
                        <line x1="7" y1="7" x2="7" y2="7"></line>
                        </svg> 
                        </div>
                        </span>  
                </a>
            </li>
        </ul>
    </nav>
</header>

<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      Research
    </h1>
    <div class="post-meta"><span title='2024-07-08 10:15:00 -0400 EDT'>July 8, 2024</span>&nbsp;·&nbsp;6 min&nbsp;·&nbsp;1066 words&nbsp;·&nbsp;Kiran

</div>
  </header> 
  <div class="post-content"><p>[Dissertation] &ndash; [RFSoC]</p>
<p>My doctroal research concentrates on designing a wideband digital receiver system to receive and process the data for accurate multiple signal detection. <a href="https://en.wikipedia.org/wiki/Fast_Fourier_transform">Fast Fourier transform (FFT)</a> is a widely used digital signal processing technique to detect signals in a bandwidth. However, there are some limitations when using the FFT algorithm for signal detection</p>
<ol>
<li>The number of fixed-length samples used by the FFT algorithm determines the frequency resolution. The number of samples from the input signal must be increased to increase the frequency resolution.</li>
<li>Increasing the number of samples for FFT calculations may increase the frequency resolution but increases the complexity of the algorithm.</li>
<li>Signal detection becomes much more difficult in the presence of noise and interference.</li>
<li>Since the FFT algorithm assumes that the fixed-length samples are periodic, in reality, the starting and ending position of fixed lengths of data is not the same, making the signal non-periodic, which leads to spectral leakage and false signal detection in the presence of noise.</li>
<li>Limited hardware resource that provides maximum accuracy for signal detection poses a significant design challenge to the engineer.</li>
</ol>
<p>The research provides a hardware efficient algorithm to implement the FFT technique for accurate signal detection</p>
<h2 id="hardware-setup">Hardware Setup<a hidden class="anchor" aria-hidden="true" href="#hardware-setup">#</a></h2>
<p>The overall hardware setup for FFT analysis is shown in figure below. The hardware setup begins with a signal source, <a href="https://www.tek.com/en/products/arbitrary-waveform-generators/awg5200">Tektronix 5200</a>, with the addition of White Gaussian noise. The signal generator is source for the input signal and clock frequency for the analog-to-digital (ADC) present on <a href="https://www.xilinx.com/products/boards-and-kits/zcu1275.html">Zynq UltraScale+ RFSoC 1275</a>. The RF Power combiner is utilized to combine two or more signals for multiple signal detection.</p>
<figure>
    <img loading="lazy" src="/ox-hugo/TestSetup2.jpg"/> 
</figure>

<h2 id="design-flow">Design Flow<a hidden class="anchor" aria-hidden="true" href="#design-flow">#</a></h2>
<p><a href="https://www.mathworks.com/products/matlab.html">Matlab</a> and <a href="https://www.xilinx.com/products/design-tools/vitis/vitis-model-composer.html">Xilinx Model Composer</a> tool sets are employed to design, simulate and verify the functionality of the proposed digital receiver. The top-down approach for the implementation is shown in the flowchat which illustrates a general design approach undertaken to design the wideband receiver. Matlab results are used as a golden reference to verify the proposed FFT hardware. The digital wideband receiver is designed and simulated using Model Composer (Previously known as System Generator).</p>
<figure class="center">
    <img loading="lazy" src="/ox-hugo/global_flow.png"/> 
</figure>

<h2 id="fft-core-designed-and-tested-in-xilinx-model-composer">FFT Core Designed and Tested in Xilinx Model Composer<a hidden class="anchor" aria-hidden="true" href="#fft-core-designed-and-tested-in-xilinx-model-composer">#</a></h2>
<p>Figure shows the design of the FFT processor in Model Composer used for simulation.</p>
<figure>
    <img loading="lazy" src="/ox-hugo/sysgen.png"/> 
</figure>

<p>Implementing the FFT algorithm in hardware comes with its own set of challenges due to the complexity of the algorithm and the requirements of real-time processing. Here are some of the key challenges involved in FFT hardware implementation and hardware optimization to overcome:</p>
<ol>
<li>
<p>Algorithm complexity: Multiplication operations were replaced by shift and add method to reduce complexity, increase speed, and introduce parallelism.</p>
</li>
<li>
<p>Fixed-point arithmetic: Dynamic Kernel function algorithm is an extension for fixed-point kernel where the unit circle is expanded by higher powers of two.</p>
</li>
<li>
<p>Numerical precision and accuracy: The FFT algorithm involves repeated numerical operations, which increases the word length at every stage, [Multiple Input Selection (MIS)] scheme is implemented to maintain precision accuracy while quantizing the output to a specific length at each stage.</p>
</li>
<li>
<p>Magnitude and peak detector: Both the magnitude estimator and peak detector are valuable tools for understanding the spectral content of a signal. Chebyshev coefficients and an advanced peak detector algorithm are implemented for accurate signal detection.</p>
</li>
<li>
<p>Parallelism and pipelining: The FFT algorithm naturally lends itself to parallel processing, essential for achieving high throughput in hardware implementations. Designing an efficient parallel architecture and managing the data flow through different processing stages is feasible with Xilinx Model Composer.</p>
</li>
</ol>
<h2 id="dual-channel-fft-processor">Dual Channel FFT Processor<a hidden class="anchor" aria-hidden="true" href="#dual-channel-fft-processor">#</a></h2>
<figure>
    <img loading="lazy" src="/ox-hugo/frame_based_fft.png"/> 
</figure>

<ol>
<li>Multiplication complexity is reduced with the implementation of shift-and-add operation in the butterfly block.</li>
<li>Multiple Input Selection (MIS) is a technique used to scale weak signals appropriately and maintain constant word length when data flows through the FFT stages.</li>
<li>[Chebyshev coefficient for square root approximation] for calculating the magnitude of the FFT output.</li>
<li>Single channel FFT shows significant improvements resulting with the lowest detectable signal strength is 500 uVpp. Single signal dynamic range (DR) is about 51 dB and maximum two-tone instantaneous dynamic range (IDR) is around 37 dB.</li>
<li>A frame-based dual-channel FFT approach desogend for the detection of three signals with a minimum separation of three frequency bin (11.72MHz).</li>
<li>[Enchanced signal detection] algorithm for multiple signal detection.</li>
</ol>
<p>The proposed method incorporates a frequency detection scheme comprising three peak detection blocks, including intermittent harmonic filtering blocks. This configuration ensures the capability to detect both strong and weak signals, relying solely on the primary channel, as long as the distance between the closest peaks is a minimum of four frequency bins (15.625MHz). To enhance signal detection robustness, we utilize differences between peaks identified in primary and auxiliary channels. This strategy reduces false alarms without a predefined threshold, enabling peak identification with a minimum separation of three frequency bins (11.72MHz) and a minimum signal strength of 40mVpp. The implemented design achieves exceptional performance,
maintaining accurate detection rate for three signals across eight distinct test scenarios with varying strengths. This highlights the effectiveness of our approach in reliably detecting signals with diverse magnitudes and frequency separations.</p>
<p>The proposed method can detect two signals at least three frequency bins apart. Two strong signals and two weak signals can be detected with less complication. The complication arises when a weak signal is located close to a strong one. The proposed method utilizes the primary and auxiliary channel output to make a decision in selecting the correct frequency location. The frequency bin location is utilized to calculate the frequency. Figure below shows the magnitude spectrum of three signals where the two strong signals are placed far apart and the weak signal is placed close to strong one. Applying the enchanded signal detection algorithm, the detected signals are at located bin location 78, 81 and 210. The two extreme peaks that are place far apart are at bin location 78 and 210 are detected by the primary channel. To detect the third signal, the FFT magnitude spectrum from the auxiliary channel is analyzed and used by the enchanded signal detection algorithm to detected the third signal at bin location 81.</p>
<figure>
    <img loading="lazy" src="/ox-hugo/2b.png"/> 
</figure>

<h2 id="publications">Publications<a hidden class="anchor" aria-hidden="true" href="#publications">#</a></h2>
<ol>
<li>&ldquo;Advancing Two-Signal Dynamic Range: A Digital Wideband Receiver for Enhanced Signal Detection.&rdquo; (Under Review)</li>
<li>&ldquo;Enhanced Radar Multiple Signal Detection Dual-Channel Multiple Time Frame Fast Fourier Transform Performance in Wideband Receivers.&rdquo; (Under Review)</li>
<li>&ldquo;Optimized Square Root Approximation using Chebyshev Coefficients for Fast Fourier Transform Performance in Wideband Receivers.&rdquo; (Under Review)</li>
<li>&ldquo;Enhanced Wideband Frequency Estimation via FFT: Leveraging Polynomial Interpolation and Array Indexing.&rdquo; Journal of Computer and Communications 12, no. 01 (2024).</li>
</ol>


  </div>



  <footer class="post-footer">
    <ul class="post-tags">
    </ul>



    <div class="bottom-line" ></div>
    
    
    
      <img src="/img/gnu.png" class="center" alt="footer" style="max-width:50px" />
    

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2024 <a href="https://24x7fpga.com/"></a></span>
        
        


</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a><footer class="footer">

</footer>



<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
